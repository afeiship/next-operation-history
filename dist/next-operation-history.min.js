/*!
 * name: @feizheng/next-operation-history
 * description: Operation history for next.
 * url: https://github.com/afeiship/next-operation-history
 * version: 1.0.0
 * date: 2020-03-28 14:30:46
 * license: MIT
 */
!function(){var t=t||this||window||Function("return this")(),e=t.nx||require("@feizheng/next-js-core2"),i=e.remove||require("@feizheng/next-remove"),n=e.hash||require("@feizheng/next-hash"),s=e.LocalStorage||require("@feizheng/next-local-storage"),r=e.SessionStorage||require("@feizheng/next-session-storage"),a={max:10,engine:"local",prefix:"nx",index:-1,data:[]},h=e.declare("nx.OperationHistory",{statics:{hash:n},properties:{index:{set:function(t){this.store.set("index",t)},get:function(){return this.store.get("index")}},data:{set:function(t){this.store.set("data",t)},get:function(){return this.store.get("data")||[]}},length:function(){return this.data.length},next:function(){var t=this.index;return t<this.options.max&&0<=t&&t<this.last()},prev:function(){return 0<this.index}},methods:{init:function(t){var i=this.options=e.mix(null,a,t),n=i.prefix+"__operation_history";this.store=new("local"===i.engine?s:r)(n),this.reset()},reset:function(){this.index=this.options.index,this.data=this.options.data},flush:function(t){this.data=t.slice(-this.options.max),this.index=this.last()},last:function(){return this.length-1},at:function(t){var i=t||this.index;return this.data[i]||null},get:function(i){return this.data.find(function(t){return t.id===i})},gets:function(){return this.data},forward:function(){var t=this.index;this.next&&(this.index=t+1)},back:function(){var t=this.index;this.prev&&(this.index=t-1)},go:function(t){if(0<=t){var i=t>=this.options.max?this.last():t;this.index=i}else{i=this.index+t;this.index=0<=i?i:0}},add:function(t){var i=this.data;i.push({id:n(t),data:t}),this.flush(i)},del:function(n){var t=i(this.data,function(t,i){return i.id===n});this.flush(t)},push:function(t){var i=this.shouldAdd(t);return i&&this.add(t),i},replace:function(t){var i=this.data,n=this.shouldAdd(t);return n&&(0<i.length?(i[i.length-1].data=t,this.flush(i)):this.push(t)),n},shouldAdd:function(t){var i=this.data[this.last()];return!i||n(i.data)!==n(t)}}});"undefined"!=typeof module&&module.exports&&(module.exports=h)}();