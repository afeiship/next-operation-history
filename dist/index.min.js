/*!
 * name: @jswork/next-operation-history
 * description: Operation history for next.
 * homepage: https://github.com/afeiship/next-operation-history
 * version: 1.0.0
 * date: 2020-11-22 14:13:14
 * license: MIT
 */
!function(){var n=(this||window||Function("return this")()).nx||require("@jswork/next"),i=n.remove||require("@jswork/next-remove"),e=n.hash||require("@jswork/next-hash"),s=n.LocalStorage||require("@jswork/next-local-storage"),r=n.SessionStorage||require("@jswork/next-session-storage"),o={max:10,engine:"local",prefix:"nx",index:-1,data:[]},t=n.declare("nx.OperationHistory",{properties:{index:{set:function(t){this.store.set("index",t)},get:function(){return this.store.get("index")}},data:{set:function(t){this.store.set("data",t)},get:function(){return this.store.get("data")||[]}},length:function(){return this.data.length},next:function(){var t=this.index;return t<this.options.max&&0<=t&&t<this.last()},prev:function(){return 0<this.index}},methods:{init:function(t){var i=this.options=n.mix(null,o,t),t=i.prefix+"__operation_history";this.store=new("local"===i.engine?s:r)(t),this.reset()},reset:function(){this.index=this.options.index,this.data=this.options.data},flush:function(t){this.data=t.slice(-this.options.max),this.index=this.last()},last:function(){return this.length-1},at:function(t){t=t||this.index;return this.data[t]||null},get:function(i){return this.data.find(function(t){return t.id===i})},gets:function(){return this.data},forward:function(){var t=this.index;this.next&&(this.index=t+1)},back:function(){var t=this.index;this.prev&&(this.index=t-1)},go:function(t){var i;0<=t?(i=t>=this.options.max?this.last():t,this.index=i):(i=this.index+t,this.index=0<=i?i:0)},add:function(t){var i=this.data;i.push({id:e(t),value:t}),this.flush(i)},del:function(n){var t=i(this.data,function(t,i){return i.id===n});this.flush(t)},push:function(t){var i=this.shouldAdd(t);return i&&this.add(t),i},replace:function(t){var i=this.data,n=this.shouldAdd(t);return n&&(0<i.length?(i[i.length-1].data=t,this.flush(i)):this.push(t)),n},shouldAdd:function(t){var i=this.data[this.last()];return!i||e(i.value)!==e(t)}}});"undefined"!=typeof module&&module.exports&&(module.exports=t)}();